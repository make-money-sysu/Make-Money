<!doctype html>
<html>
<head>
    <!-- Required meta tags -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, shrink-to-fit=no">
    <title>user_center</title>
    <link rel="stylesheet" href="../bootstrap-3.3.7-dist/bootstrap-3.3.7-dist/css/bootstrap.min.css">
    <script src="../js/jquery-3.2.1.min.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="../bootstrap-3.3.7-dist/bootstrap-3.3.7-dist/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="../css/02.css">
	<script src="../js/2.js"></script>
</head>
<body onload="getUserInfo()">
	<div id="back-up" onclick="goToWhere()"
        style=" height: 58px; width: 58px; position: fixed; cursor: pointer; right: 0px; bottom: 50px;">
		<img src="../image/b1.png" height="58px" width="58px">
	</div>
	<div class="container container_user_center col-md-10 col-md-offset-1">
        <div class="back">
            <a onclick="javascript:window.parent.location.href = '/HomePage';">回到首页</a>
            <a onclick="logout()">注销</a>
        </div>
		<div class="user_info col-md-6 col-md-offset-3">
			<img class='user_icon' title='点击更换头像' style='border-radius: 50%;width: 150px;height: 150px; margin-bottom: 30px;' src=../image/2089312254@chatroom_1486356859619_63.jpg onclick='#save' data-toggle='modal' data-target='#save'/>
			<br/>
            <span class="user_name" id="modified_name">用户</span><span class="user_name">，欢迎您!</span>
            <br/>
            <span class="user_name">您账号余额为：</span><span class="user_name" id="my_balance">***</span>
		</div>
		<div class="col-md-8 col-md-offset-2 ">
            <div class="col-md-6">
                <a href="#revise_part" class="func_nav">修改资料</a>
				<a onclick="javascript:window.parent.location.href = '/QuestionnaireList';" class="func_nav">我的问卷</a>
            </div>
			<div class="col-md-6">
                <a onclick="javascript:window.parent.location.href = '/ExpressDelivery';" class="func_nav">我的快递</a>
				<a onclick="javascript:window.parent.location.href = '/ExpressDelivery';" class="func_nav">我要查询</a>
            </div>
        </div>
		
		<div class="col-md-10 col-md-offset-1">


            <div class="revise" id="revise_part">
				<h3 class="col-md-10">修改资料</h4>
                <div class="line col-md-12  "></div>
                <br/>
                
                <form class="form-horizontal col-md-10" id="user_center_edit" role="form">
                    <div class="form-group">
                        <label class="control-label col-md-2" for="name">用户名</label>
                        <div class="col-md-6">
                            <input type="text" class="form-control" name="name" id="name" placeholder="请输入用户名">
                            <span id="isCan" style="color: red;"></span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-md-2" for="student_num">学号</label>
                        <div class="col-md-6">
                            <input type="text" class="form-control" name="student_num" id="student_num" placeholder="请输入学号">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-md-2" for="sex">性别</label>
                        <div class="col-md-6">
                            <select class="form-control" name="sex" id="sex" >
                                <option value="male">男</option>
                                <option value="female">女</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-md-2" for="real_name">真实姓名</label>
                        <div class="col-md-6">
                            <input type="text" class="form-control" name="real_name" id="real_name" placeholder="请输入真实姓名">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-md-2" for="password">密码</label>
                        <div class="col-md-6">
                            <input type="password" class="form-control" name="password" id="password" placeholder="请输入密码">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-md-2" for="password_1">确认密码</label>
                        <div class="col-md-6">
                            <input type="password" class="form-control" name="password_1" id="password_1" placeholder="请再次输入密码">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-md-2" for="age">年龄</label>
                        <div class="col-md-6">
                            <input type="text" class="form-control" name="age" id="age" placeholder="请输入年龄">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-md-2" for="profession">专业</label>
                        <div class="col-md-6">
                            <input type="text" class="form-control" name="profession" id="profession" placeholder="请输入专业">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-md-2" for="grade">年级</label>
                        <div class="col-md-6">
                            <input type="text" class="form-control" name="grade" id="grade" placeholder="请输入年级">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-md-2" for="tel">电话</label>
                        <div class="col-md-6">
                            <input type="text" class="form-control" name="tel" id="tel" placeholder="请输入电话">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-md-2" for="email">邮箱</label>
                        <div class="col-md-6">
                            <input type="text" class="form-control" name="email" id="email" placeholder="请输入邮箱">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-md-2"> </label>
                        <button class="btn btn-default " type="submit" onClick="updateUserInfo()">保存</button>
                    </div>
                </form>
            </div>
		</div>
		
		<!-- <div class="col-md-10 col-md-offset-1 search1">
			<div class="search" id="search_part">
				<h3 class="col-md-10">我的问卷</h4>
                <div class="line col-md-12  "></div>
                <br/>
                
                <div class="form-group">
                    <label class="col-md-2 control-label" for="name">该账号暂无问卷信息</label>
            	</div>
			</div>
		</div>
		
		<div class="col-md-10 col-md-offset-1 search1">
            <div class="send" id="send_part">
				<h3 class="col-md-10">我的快递</h4>
                <div class="line col-md-12  "></div>
                <br/>

                <div class="form-group">
                    <label class="col-md-2 control-label" for="name">该账号暂无快递信息</label>
            	</div>
            </div>
		</div> 
		
		<div class="col-md-10 col-md-offset-1">
            <div class="receive" id="receive_part">
				<h3 class="col-md-10">我要查询</h4>
                <div class="line col-md-12"></div>
                <br/> -->
<!--                 
                 <form method="post" action="#" class="form-horizontal col-md-10" id="user_center_receiver" role="form">
					 <div class="form-group">
                        <label class="control-label col-md-2" for="start_pos">高铁出发点</label>
                        <div class="col-md-8">
                            <input class="form-control col-md-4 disabled" onblur="checkStartPos()" placeholder="请输入高铁出发点" id="start_pos" value="">
							<div id="startpos_prompt"></div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-md-2" for="train_num">车次</label>
                        <div class="col-md-8">
                            <input class="form-control col-md-4 disabled" onblur="checkTrainNum()" placeholder="请输入车次" id="train_num" value="">
							<div id="trainnum_prompt"></div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-md-2" for="start_time">高铁出发时间</label>
                        <div class="col-md-8">
                            <input class="form-control col-md-4" onblur="checkStartTime()" placeholder="请输入高铁出发时间" id="start_time" value="">
							<div id="starttime_prompt"></div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="control-label col-md-2"> </label>
                        <button class="btn btn-default " type="submit" onClick="mySub2()">查询</button>
                    </div>
                </form> -->
            <!-- </div>
		</div> -->
<!-- 模态框（Modal） -->
    <div class="modal fade" id="save" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close btn btn-default" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title" id="myModalLabel">修改头像</h4>
                </div>
                <div class="modal-body">
				<form  method="post" class="form-horizontal" action="#" enctype="multipart/form-data" role="form">
                 
			    <input type="file" id="file" name="file" >
				
				<div class="modal-footer">
				<input type="submit" class="btn btn-success save" value="保存"/>
                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                </div>
                <br />
                
                </form>
				</div>
                
            </div><!-- /.modal-content -->
        </div><!-- /.modal -->
    </div>

</body>
<script type="text/javascript">
    function logout(){
        url_delete = "http://139.199.166.124:8080/login";
        axios.defaults.withCredentials=true;

        axios.delete(url_delete)
        .then(response => {
            javascript:window.parent.location.href = '/HomePage';
            console.log(response.data)
        })
        .catch(error => {
            console.log(error)
        })
    }
    function getUserInfo(){
        $("#question").bind("click",function(){
		    window.parent.location.href = "/QuestionnaireList";
        });
        
        $("#express").on("click",function(){
            window.parent.location.href = "/ExpressDelivery";
        });

        var userName = document.getElementById("name");
        var student_num = document.getElementById("student_num");
        var sex = document.getElementById("sex");
        var real_name = document.getElementById("real_name");
        var age = document.getElementById("age");
        var profession = document.getElementById("profession");
        var tel = document.getElementById("tel");
        var email = document.getElementById("email");
        var balance = document.getElementById("my_balance");
        $.ajax({
            type: "get",
            dataType: 'json',
            // url: "http://182.254.206.244:8080/user",
            url: "http://139.199.166.124:8080/user/", //lt
            xhrFields: {
                withCredentials: true    // 要在这里设置上传cookie
            },
            crossDomain: true,
            success: function(data){
                console.log('success');
                data = data['data'];
                $("#modified_name").html(data['nick_name']);
                $("#my_balance").html(data['balance']);
                console.log(data['balance']);
                userName.value = data["nick_name"];
                student_num.value = data["id"];
                sex.value = data["gender"];
                real_name.value = data["real_name"];
                age.value = data["age"];
                profession.value = data["profession"];
                tel.value = data["phone"];
                email.value = data["email"];
            },
            error: function(Request, status, msg){
                // console.log(Request);
                // console.log(status);
                // console.log(msg);
                console.log('fail');
            }
        });
    }
    function updateUserInfo(){
        var userName = document.getElementById("name").value;
        var student_num = document.getElementById("student_num").value;
        var sex = document.getElementById("sex").value;
        var real_name = document.getElementById("real_name").value;
        var password = document.getElementById("password").value;
        var password_1 = document.getElementById("password_1").value;
        var age = document.getElementById("age").value;
        var profession = document.getElementById("profession").value;
        var tel = document.getElementById("tel").value;
        var email = document.getElementById("email").value;
        var grade = document.getElementById("grade").value;
        
        var gender = "0";
        if (sex == "男"){
            gender = "1";
        }
        if (password != password_1){
            alert("两次密码输入不一致，修改失败");
            return;
        }
        // 更新用户信息
        url_put = "http://139.199.166.124:8080/user";
        // console.log(grade)
        axios.put(url_put, JSON.stringify({
            "id" : parseInt(student_num),
            "password" : password,
            "real_name" : real_name,
            "nick_name" : userName,
            "age" : parseInt(age),
            "gender" : gender,
            "head_picture" : "blob not null",
            // "balance" : 10,
            "profession" : profession,
            "grade" : grade,
            "phone" : tel,
            "email" : email
          }))
        .then(response => {
            console.log(response.data)
        })
        .catch(error => {
            console.log(error)
        })
        // axios.put(url_put, JSON.stringify({
        //     "id" : parseInt(student_num),
        //     "password" : password,
        //     "real_name" : real_name,
        //     "nick_name" : userName,
        //     "age" : parseInt(age),
        //     "gender" : gender,
        //     "head_picture" : "",
        //     "balance" : 0,
        //     "profession" : profession,
        //     "grade" : grade,
        //     "phone" : tel,
        //     "email" : email
        // }))
        // .then(function(res){
        //     console.log('success');
        //     console.log(res);//处理成功的函数 相当于success
        //     })
        // .catch(function(error){
        //     console.log('fail');
        //     console.log(error);//错误处理 相当于error
        // })
       
        return true;
    }
    
</script>
</html>
